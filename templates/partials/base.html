{% load static %}
<!DOCTYPE html>
<html lang="zxx">
    <head>
        <meta charset="utf-8" />
        <meta name="author" content="Ecommerce" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>NEO Store</title>
        <link rel="icon" type="image/svg+xml" href="{% static 'assets/img/NEO.svg' %}" />
        <link rel="apple-touch-icon" href="{% static 'assets/img/NEO.svg' %}" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

        <link href="{% static 'assets/css/styles.css' %}" rel="stylesheet" />
        <link href="{% static 'assets/css/responsive.css' %}" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
        <style>
            @media (min-width: 993px) {
                .nav-menu li {
                    display: flex;
                    align-items: center;
                }
                .nav-menu li a {
                    display: flex;
                    align-items: center;
                }
                .nav-menus-wrapper {
                    display: flex;
                    align-items: center;
                }
                .nav-menu {
                    display: flex;
                    align-items: center;
                }
            }
            .navigation {
                min-height: 80px;
            }
            .nav-menu>li .nav-dropdown,
            .nav-menu>li .nav-submenu {
                top: 50px !important;
                margin-top: 0 !important;
                padding-top: 15px !important;
                z-index: 1000 !important;
            }
            .nav-menu>li>.nav-dropdown:before {
                top: -12px !important;
            }
            
            /* Dropdown должен быть выше поиска */
            .nav-dropdown {
                z-index: 1000 !important;
            }
            
            /* Мобильная версия - отключены hover эффекты для оптимизации */
            @media (max-width: 992px) {
                /* Только активные элементы, без hover */
                .nav-menu>li.active .nav-dropdown {
                    display: block !important;
                }
                
                /* Убеждаемся, что текст виден в мобильном меню */
                .navigation-portrait .nav-menu>li>a {
                    color: #2c2c2c !important;
                }
                
                /* Только активные элементы, без hover */
                .navigation-portrait .nav-menu>li.active>a,
                .navigation-portrait .nav-menu>li.focus>a {
                    color: #FF0000 !important;
                    background-color: #f8f8f8;
                }
                
                /* Отключаем все hover эффекты для мобильных */
                .navigation-portrait .nav-menu>li:hover>a,
                .navigation-portrait .nav-menu>li:active>a,
                .navigation-portrait .nav-dropdown>li:hover>a,
                .navigation-portrait .nav-dropdown>li:active>a {
                    color: #2c2c2c !important;
                    background-color: transparent !important;
                }
            }
            @media (max-width: 992px) {
                .nav-menu .btn.bg-primary {
                    padding: 0.25rem 0.75rem !important;
                    font-size: 0.875rem !important;
                }
                .nav-menu-social .fa-shopping-basket {
                    color: #000000 !important;
                }
                .nav-menu-social .fa-search,
                .nav-menu-social .fa-user,
                .nav-menu-social .fa-heart {
                    color: #000000 !important;
                }
                .logo-desktop {
                    display: none !important;
                }
                .logo-mobile {
                    display: block !important;
                }
            }
            @media (min-width: 993px) {
                .logo-mobile {
                    display: none !important;
                }
                .logo-desktop {
                    display: block !important;
                }
            }
            
            /* Скрыть кнопку "Меню" в мобильной версии */
            @media (max-width: 992px) {
                .sidebar-toggle-btn {
                    display: none !important;
                }
                
                /* Скрыть иконки в header (пользователь, уведомления, корзина) в мобильной версии */
                .mobile_nav {
                    display: none !important;
                }
            }
        </style>
    </head>

    <body>
        <div id="main-wrapper">
            <div class="header header-dark dark-text">
                <div class="container">
                    <nav id="navigation" class="navigation navigation-landscape">
                        <div class="nav-header">
                            <a class="nav-brand" href="{% url 'store:index' %}">
                                <img style="width: 170px; object-fit: contain;" src="{% static 'assets/img/NEO-white.svg' %}" class="logo logo-desktop" alt="" />
                                <img style="width: 170px; object-fit: contain;" src="{% static 'assets/img/NEO.svg' %}" class="logo logo-mobile" alt="" />
                            </a>
                            <div class="nav-toggle"></div>
                            <div class="mobile_nav">
                                <ul>
                                    <li>
                                        <a href="#"><i class="fas fa-search-alt"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="fas fa-user"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"> <i class="fas fa-heart text-white"></i><span class="dn-counter">2</span> </a>
                                    </li>
                                    <li>
                                        <a href="{% url 'store:cart' %}"> <i class="fas fa-shopping-basket"></i><span class="dn-counter total_cart_items">{{total_cart_items}}</span> </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="nav-menus-wrapper">
                            <ul class="nav-menu">
                                <li><a href="/">Главная</a></li>
                                <li>
                                    <a href="{% url 'store:shop' %}">Магазин</a>
                                </li>
                                 <li>
                                    <a href="javascript:void(0);">Категории</a>
                                    <ul class="nav-dropdown nav-submenu">
                                        
                                        {% for c in category_ %}
                                            <li><a href="{% url 'store:category' c.id %}">{{c.title}}</a></li>
                                        {% endfor %}
                                            
                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:void(0);">Продавец</a>
                                    <ul class="nav-dropdown nav-submenu">
                                        <li><a href="{% url 'vendor:dashboard' %}">Панель управления</a></li>
                                        <li><a href="{% url 'vendor:products' %}">Товары</a></li>
                                        <li><a href="{% url 'vendor:create_product' %}">Создать товар</a></li>
                                        <li><a href="{% url 'vendor:orders' %}">Заказы</a></li>
                                        <li><a href="{% url 'vendor:coupons' %}">Купоны</a></li>
                                        <li><a href="{% url 'vendor:notis' %}">Уведомления</a></li>
                                        <li><a href="{% url 'vendor:reviews' %}">Отзывы</a></li>
                                        <li><a href="{% url 'vendor:notis' %}">Уведомления</a></li>
                                        <li><a href="{% url 'vendor:profile' %}">Профиль</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:void(0);">Покупатель</a>
                                    <ul class="nav-dropdown nav-submenu">
                                        <li><a href="{% url 'customer:dashboard' %}">Панель управления</a></li>
                                        <li><a href="{% url 'customer:orders' %}">Заказы</a></li>
                                        <li><a href="{% url 'customer:wishlist' %}">Избранное</a></li>
                                        <li><a href="{% url 'customer:addresses' %}">Адреса</a></li>
                                        <li><a href="{% url 'customer:notis' %}">Уведомления</a></li>
                                        <li><a href="{% url 'customer:profile' %}">Профиль</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:void(0);">Страницы</a>
                                    <ul class="nav-dropdown nav-submenu">
                                        <li><a href="{% url 'blog:blog_list' %}">Блог</a></li>
                                        <li><a href="{% url 'store:about' %}">О нас</a></li>
                                        <li><a href="{% url 'store:contact' %}">Контакты</a></li>
                                        <li><a href="{% url 'store:faqs' %}">Часто задаваемые вопросы</a></li>
                                        <li><a href="{% url 'store:privacy_policy' %}">Политика конфиденциальности</a></li>
                                        <li><a href="{% url 'store:terms_conditions' %}">Условия использования</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="{% url 'store:order_tracker_page' %}">Отследить заказ <i class="fas fa-truck ms-1"></i></a>
                                </li>
                            </ul>

                            <ul class="nav-menu nav-menu-social align-to-right" style="display: flex; align-items: center;">
                                <li>
                                    <a href="{% url 'store:shop' %}"><i class="fas fa-search text-white"></i></a>
                                </li>
                               
                               {% if request.user.is_authenticated %}
                                     <li>
                                        <a href="{% url 'customer:dashboard' %}"><i class="fas fa-user text-white"></i></a>
                                    </li>
                                    <li>
                                        <a href="{% url 'customer:wishlist' %}"><i class="fas fa-heart text-white"></i><span class="dn-counter">{{ wishlist_count }}</span> </a>
                                    </li>
                               {% endif %}
                                
                                <li>
                                    <a href="{% url 'store:cart' %}"><i class="fas fa-shopping-basket text-white"></i><span class="dn-counter total_cart_items">{{total_cart_items}}</span> </a>
                                </li>
                                
                                {% if request.user.is_authenticated %}
                                    
                                    <li>
                                        <a href="{% url 'userauths:sign-out' %}" class="btn bg-primary py-2 px-4 rounded text-white"><i class="fas fa-sign-out-alt me-1"></i> Выйти </a>
                                    </li>
                                {% else %}
                                    <li>
                                        <a href="{% url 'userauths:sign-in' %}" class="btn bg-primary py-1 px-3 rounded text-white btn-sm me-2">Войти <i class="fas fa-sign-in-alt ms-1"></i></a>
                                    </li>
                                    <li>
                                        <a href="{% url 'userauths:sign-up' %}" class="btn bg-primary py-1 px-3 rounded text-white btn-sm">Регистрация <i class="fas fa-user-plus ms-1"></i></a>
                                    </li>
                                {% endif %}
                                    
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>

           
           {% for message in messages %}
                <div class="alert alert-{{message.tags}} alert-dismissible fade show text-center" role="alert">
                    <strong>{{message}}</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
           {% endfor %}
            

            {% block content %} {% endblock content %}

            <footer class="dark-footer skin-dark-footer" style="margin-top: 500px">
                <div class="footer-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-4 col-lg-4 col-md-3 col-sm-12">
                                <div class="footer_widget">
                                    <img src="{% static 'assets/img/NEO-white.svg' %}" class="img-footer small mb-2" alt="" />

                                    <div class="address mt-3">neodevelopmentfund@gmail.com</div>
                                </div>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-2 col-sm-12">
                                <div class="footer_widget">
                                    <h4 class="widget_title">Поддержка</h4>
                                    <ul class="footer-menu">
                                        <li><a href="#">Связаться с нами</a></li>
                                        <li><a href="#">О нас</a></li>
                                        <li><a href="#">Часто задаваемые вопросы</a></li>
                                        <li><a href="#">Политика конфиденциальности</a></li>
                                        <li><a href="#">Условия использования</a></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-xl-4 col-lg-4 col-md-3 col-sm-12">
                                <div class="footer_widget">
                                    <h4 class="widget_title">Подписаться</h4>
                                    <p>Получайте обновления, горячие предложения и скидки прямо на вашу почту ежедневно</p>
                                    <div class="foot-news-last">
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="Адрес электронной почты" />
                                            <div class="input-group-append">
                                                <button type="button" class="input-group-text b-0 text-light"><i class="fas fa-arrow-right"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <script src="{% static 'assets/js/jquery.min.js' %}"></script>
        <script src="{% static 'assets/js/popper.min.js' %}"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'assets/js/ion.rangeSlider.min.js' %}"></script>
        <script src="{% static 'assets/js/slick.js' %}"></script>
        <script src="{% static 'assets/js/slider-bg.js' %}"></script>
        <script src="{% static 'assets/js/lightbox.js' %}"></script>
        <script src="{% static 'assets/js/smoothproducts.js' %}"></script>
        <script src="{% static 'assets/js/snackbar.min.js' %}"></script>
        <script src="{% static 'assets/js/jQuery.style.switcher.js' %}"></script>
        <script src="{% static 'assets/js/custom.js' %}"></script>
        <script src="{% static 'assets/js/function.js' %}?v=2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <!-- Мобильный hover для dropdown menu -->
        <script>
            (function() {
                // Определяем, является ли устройство touch-устройством
                const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                
                if (isTouchDevice && window.innerWidth <= 992) {
                    // Обработка touch событий для dropdown menu (отключена - используется основной скрипт navigation)
                    // Этот код был отключен, так как он блокировал переходы по ссылкам
                    // Основная логика обработки находится в custom.js
                }
            })();
        </script>

        <!-- Адаптивный JavaScript для мобильных устройств -->
        <script>
            // Управление фильтрами на странице магазина
            document.addEventListener('DOMContentLoaded', function() {
                // Создание оверлея для фильтров
                let filterOverlay = document.querySelector('.filter-overlay');
                if (!filterOverlay) {
                    filterOverlay = document.createElement('div');
                    filterOverlay.className = 'filter-overlay';
                    document.body.appendChild(filterOverlay);
                }
                
                // Создание оверлея для сайдбаров
                let sidebarOverlay = document.querySelector('.sidebar-overlay');
                if (!sidebarOverlay) {
                    sidebarOverlay = document.createElement('div');
                    sidebarOverlay.className = 'sidebar-overlay';
                    document.body.appendChild(sidebarOverlay);
                }
                
                // Фильтры магазина
                const filterToggleBtn = document.querySelector('.filter-toggle-btn');
                const shopFilters = document.querySelector('.shop-filters');
                const closeFiltersBtn = document.querySelector('.close-filters-btn');
                
                if (filterToggleBtn && shopFilters) {
                    filterToggleBtn.addEventListener('click', function() {
                        shopFilters.classList.add('show');
                        filterOverlay.classList.add('show');
                        if (closeFiltersBtn) closeFiltersBtn.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                    });
                    
                    if (closeFiltersBtn) {
                        closeFiltersBtn.addEventListener('click', function() {
                            shopFilters.classList.remove('show');
                            filterOverlay.classList.remove('show');
                            this.style.display = 'none';
                            document.body.style.overflow = '';
                        });
                    }
                    
                    // Закрытие при клике на оверлей
                    filterOverlay.addEventListener('click', function() {
                        shopFilters.classList.remove('show');
                        this.classList.remove('show');
                        if (closeFiltersBtn) closeFiltersBtn.style.display = 'none';
                        document.body.style.overflow = '';
                    });
                }
                
                // Управление сайдбарами
                const sidebarToggleBtns = document.querySelectorAll('.sidebar-toggle-btn');
                const sidebars = document.querySelectorAll('.sidebar');
                const closeSidebarBtns = document.querySelectorAll('.close-sidebar-btn');
                
                sidebarToggleBtns.forEach(function(btn, index) {
                    btn.addEventListener('click', function() {
                        const sidebar = this.nextElementSibling;
                        if (sidebar && sidebar.classList.contains('sidebar')) {
                            sidebar.classList.add('show');
                            sidebarOverlay.classList.add('show');
                            const closeBtn = sidebar.querySelector('.close-sidebar-btn');
                            if (closeBtn) closeBtn.style.display = 'block';
                            document.body.style.overflow = 'hidden';
                        }
                    });
                });
                
                closeSidebarBtns.forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        const sidebar = this.closest('.sidebar');
                        if (sidebar) {
                            sidebar.classList.remove('show');
                            sidebarOverlay.classList.remove('show');
                            this.style.display = 'none';
                            document.body.style.overflow = '';
                        }
                    });
                });
                
                // Закрытие сайдбаров при клике на оверлей
                sidebarOverlay.addEventListener('click', function() {
                    sidebars.forEach(function(sidebar) {
                        if (sidebar.classList.contains('show')) {
                            sidebar.classList.remove('show');
                            const closeBtn = sidebar.querySelector('.close-sidebar-btn');
                            if (closeBtn) closeBtn.style.display = 'none';
                        }
                    });
                    this.classList.remove('show');
                    document.body.style.overflow = '';
                });
                
                // Адаптация таблиц для мобильных
                const tables = document.querySelectorAll('table');
                tables.forEach(function(table) {
                    if (window.innerWidth <= 767.98) {
                        table.classList.add('table-mobile-card');
                        const thead = table.querySelector('thead');
                        if (thead) {
                            const headers = thead.querySelectorAll('th');
                            const tbody = table.querySelector('tbody');
                            if (tbody) {
                                const rows = tbody.querySelectorAll('tr');
                                rows.forEach(function(row) {
                                    const cells = row.querySelectorAll('td');
                                    cells.forEach(function(cell, index) {
                                        if (headers[index]) {
                                            cell.setAttribute('data-label', headers[index].textContent);
                                        }
                                    });
                                });
                            }
                        }
                    }
                });
                
                // Обработка изменения размера окна
                let resizeTimer;
                window.addEventListener('resize', function() {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(function() {
                        // Закрытие всех открытых сайдбаров и фильтров при изменении размера
                        if (window.innerWidth > 991.98) {
                            sidebars.forEach(function(sidebar) {
                                sidebar.classList.remove('show');
                            });
                            if (shopFilters) {
                                shopFilters.classList.remove('show');
                            }
                            filterOverlay.classList.remove('show');
                            sidebarOverlay.classList.remove('show');
                            document.body.style.overflow = '';
                        }
                    }, 250);
                });
            });
        </script>

        <!-- Mobile Bottom Navigation Menu -->
        <div class="mobile-bottom-nav">
            <a href="{% url 'store:index' %}" class="mobile-nav-item {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
                <i class="fas fa-home"></i>
                <span>Главная</span>
            </a>
            <a href="{% url 'store:shop' %}" class="mobile-nav-item {% if request.resolver_match.url_name == 'shop' %}active{% endif %}">
                <i class="fas fa-search"></i>
                <span>Поиск</span>
            </a>
            <a href="{% url 'store:cart' %}" class="mobile-nav-item {% if request.resolver_match.url_name == 'cart' %}active{% endif %}">
                <i class="fas fa-shopping-basket"></i>
                <span>Корзина</span>
                {% if total_cart_items > 0 %}
                <span class="mobile-nav-badge">{{ total_cart_items }}</span>
                {% endif %}
            </a>
            {% if request.user.is_authenticated %}
                <a href="{% url 'customer:wishlist' %}" class="mobile-nav-item {% if request.resolver_match.url_name == 'wishlist' %}active{% endif %}">
                    <i class="fas fa-heart"></i>
                    <span>Избранное</span>
                    {% if wishlist_count > 0 %}
                    <span class="mobile-nav-badge">{{ wishlist_count }}</span>
                    {% endif %}
                </a>
            {% else %}
                <a href="{% url 'userauths:sign-in' %}" class="mobile-nav-item">
                    <i class="fas fa-heart"></i>
                    <span>Избранное</span>
                </a>
            {% endif %}
            {% if request.user.is_authenticated %}
                <a href="{% url 'customer:profile' %}" class="mobile-nav-item {% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                    <i class="fas fa-user"></i>
                    <span>Профиль</span>
                </a>
            {% else %}
                <a href="{% url 'userauths:sign-in' %}" class="mobile-nav-item {% if request.resolver_match.url_name == 'sign-in' or request.resolver_match.url_name == 'sign-up' %}active{% endif %}">
                    <i class="fas fa-user"></i>
                    <span>Профиль</span>
                </a>
            {% endif %}
        </div>

    </body>
</html>
