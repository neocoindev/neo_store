{% load static %}
{% load currency_tags %}
{% load humanize %}

<!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–±–µ–∑ –æ–±–µ—Ä—Ç–∫–∏ - –æ–±–µ—Ä—Ç–∫–∞ —É–∂–µ –µ—Å—Ç—å –≤ shop.html) -->
{% for p in products %}
<div class="wb-product-card">
        <a href="{% url 'store:product_detail' p.slug %}" style="text-decoration: none; color: inherit;">
            <div class="wb-product-image-wrapper">
                {% if p.image %}
                    <img 
                        src="{{ p.image.url }}" 
                        alt="{{ p.name }}" 
                        class="wb-product-image" 
                        loading="eager"
                        decoding="async"
                        fetchpriority="high"
                    />
                {% else %}
                    <img 
                        src="{% static 'images/default-product.jpg' %}" 
                        alt="No image" 
                        class="wb-product-image" 
                        loading="eager"
                        decoding="async"
                    />
                {% endif %}
                
                <!-- –ë–µ–π–¥–∂ —Å–∫–∏–¥–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞) -->
                {% if p.regular_price and p.regular_price > p.price %}
                    <div class="wb-product-discount">–°–∫–∏–¥–∫–∞</div>
                {% endif %}
            </div>
            
            <div class="wb-product-info">
                <div class="wb-product-category">{{ p.category.title|default:"–ö–∞—Ç–µ–≥–æ—Ä–∏—è" }}</div>
                <div class="wb-product-name">{{ p.name }}</div>
                
                <!-- –†–µ–π—Ç–∏–Ω–≥ -->
                <div class="wb-product-rating">
                    <div class="wb-product-stars">
                        {% if p.average_rating > 0 and p.average_rating < 2 %}
                            ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ
                        {% elif p.average_rating > 1 and p.average_rating < 3 %}
                            ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ
                        {% elif p.average_rating > 2 and p.average_rating < 4 %}
                            ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ
                        {% elif p.average_rating > 3 and p.average_rating < 5 %}
                            ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ
                        {% elif p.average_rating > 4 %}
                            ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
                        {% else %}
                            ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ
                        {% endif %}
                    </div>
                </div>
                
                <!-- –¶–µ–Ω–∞ -->
                <div class="wb-product-price-wrapper">
                    <span class="wb-product-price">{% format_currency p.price %}</span>
                    {% if p.regular_price and p.regular_price > p.price %}
                        <span class="wb-product-old-price">{% format_currency p.regular_price %}</span>
                    {% endif %}
                </div>
            </div>
        </a>
        
        <!-- –î–µ–π—Å—Ç–≤–∏—è —Å —Ç–æ–≤–∞—Ä–æ–º -->
        <div class="wb-product-actions">
            <button 
                type="button" 
                class="wb-add-to-cart-btn add_to_cart" 
                data-id="{{ p.id }}"
            >
                –í –∫–æ—Ä–∑–∏–Ω—É
            </button>
            <input type="hidden" class="quantity" value="1" />
            <a 
                href="#" 
                class="wb-wishlist-btn add_to_wishlist" 
                data-product_id="{{ p.id }}"
            >
                <i class="fas fa-heart"></i>
            </a>
        </div>
</div>
{% empty %}
<!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç -->
<div class="wb-empty-state">
    <div class="wb-empty-state-icon">üì¶</div>
    <div class="wb-empty-state-text">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
    <div class="wb-empty-state-subtext">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</div>
</div>
{% endfor %}